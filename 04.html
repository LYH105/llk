<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>常用事件对象属性</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<style type="text/css">
			#box{
				width: 200px;
				height: 200px;
				background-color: red;
			}
			#div1{
				width: 200px;
				height: 200px;
				background-color: red;
				margin-left: 1000px;
				margin-top: 1000px;
			}
			#div2{
				width: 200px;
				height: 200px;
				background-color: aquamarine;
				position: absolute;
				left: 300px;
				top: 300px;
			}
			#div3{
				width: 200px;
				height: 200px;
				background-color: aqua;
				position: absolute;
				top: 300px;
				left: 0;
				color: #fff;
				font-size: 20px;
				line-height: 200px;
			}
		</style>
	</head>
	<body>
		<div id="box"></div>
		<div id="div1">摸我我会变色</div>
		<div id="div2">拖动我我会动
		</div>
		<div id="div3">捏我放大缩小</div>
		<script type="text/javascript">
			
			/* 
			移动端常用事件：
				1、ontouchstart 开始触摸
				2、ontouchmove 移动触摸（触摸中）
				3、ontouchend  停止触摸
				4、ontouchcancel 取消触发，这是被动触发的事件，因为移动设备中有一些优先级比较高的任务，比如来电、闹铃、事件提醒等，如果我们正常触发移动事件时同时又发生了优先级比较高的事件，系统会丢弃原来正在触发的事件，进而触发ontouchcancel。
			    我们在在ontouchcancel里做一些与当前操作有关的保护性操作，比：暂停游戏，暂停音频或者视频，保存目前的数据等...
			 */
			box.ontouchstart=function(){
			console.log('开始触摸')
		}
		function randomcolor() {
			var r = Math.floor(Math.random() * 256);
			var g = Math.floor(Math.random() * 256);
			var b = Math.floor(Math.random() * 256);
			return 'rgb(' + r + ',' + g + ',' + b + ')'
		}
		box.ontouchmove=function(e){
			var even=e||event
			even.preventDefault()
			this.style.backgroundColor=randomcolor()
		}
			box.ontouchend = function(){
				alert('结束触摸！');
			}
			box.ontouchcancel = function(){
				alert('事件取消！');
			}
			
			/* 
			移动端因为可以接受多个触摸点，所以我们如果想要获取到触摸点的位置信息，不能直接通过事件对象获取了，要想获取触摸点位置信息，需要先获取触摸点，在获取该点的位置信息。
			 以下三个属性都会得到一个触摸点集合（数组），里边存储的是一个一个的触摸点对象
				1、touches  当前屏幕上的所有触摸点集合
				2、targetTouches 触发事件元素上的所有触摸点集合
				3、changedTouches 距离最近一次触摸点变换的集合
				
			触摸点对象的常用属性：
				1、clientX/Y  触摸点距离浏览器左端和上端的距离
				2、screenX/Y  触摸点距离屏幕左端和上端的距离
				3、pageX/Y    触摸点距离页面左端和上端的距离
			 */
			div1.ontouchstart = function(e){
				var even = e || event;
				console.log(even);
				
				alert(`clientX/Y:${even.targetTouches[0].clientX},${even.targetTouches[0].clientY}; screenX/Y:${even.targetTouches[0].screenX},${even.targetTouches[0].screenY}; pageX/Y:${even.targetTouches[0].pageX},${even.targetTouches[0].pageY}`);
			}
			//移动端拖拽
			div2.ontouchstart=function(e){
				var even=e||event
				//阻止默认事件
				even.preventDefault()
				//获取触摸点(在当前事件元素上的触摸点) 目的 获取触摸点距离左端和上端的距离
				var touchObj=even.targetTouches[0];
				var xv=touchObj.clientX-this.offsetLeft;
				var xy=touchObj.clientY-this.offsetTop;
				console.log(xv,xy);
				document.ontouchmove=function(e){
					var even=e||event;
					var touchObj=even.targetTouches[0];
					div2.style.left=touchObj.clientX-xv+'px'
					div2.style.top=touchObj.clientY-xy+'px'
				}
				document.ontouchend=function(){
					//重置ontouchmove事件
					document.ontouchmove=null
				}
			}
			//移动元素缩放
					var firstpos1={
			x:0,
			y:0
		}
		var firstpos2={
			x:0,
			y:0
		}
		var nowpos1={
			x:0,
			y:0
		}
		var nowpos2={
			x:0,
			y:0
		}
		div3.ontouchstart=function(e){
			var even=e||event
			even.preventDefault()
			//第一个触摸点
			var touch1=even.touches[0]
			//第二个触摸点
			var touch2=even.touches[1]
			//获取最初两个触摸点的位置信息
			firstpos1.x=touch1.clientX
			firstpos1.y=touch1.clientY
			firstpos2.x=touch2.clientX
			firstpos2.y=touch2.clientY
			
			document.ontouchmove=function(e){
				var even=e||event
				even.preventDefault()
				//不断的获取最新的两个触摸点之间的距离
				//第一个触摸点
				var touch1=even.touches[0]
				//第二个触摸点
				var touch2=even.touches[1]
				//最新触摸点的位置信息
				nowpos1.x=touch1.clientX
				nowpos1.y=touch1.clientY
				nowpos1.x=touch2.clientX
				nowpos1.y=touch2.clientY
				//第一次两个触摸点的 水平方向的距离(第一个触摸点 x - 第二个触摸点x)，取绝对值
				//Math.abs(firstpos1.x-firstpos2.x)
				//第一次两个触摸点的 垂直方向的距离(第一个触摸点y - 第二个触摸点 y)，取绝对值
				//Math.abs(firstpos1.y-firstpos2.y)
				
				//两个触摸点中间的距离
				var dis= Math.sqrt( Math.pow(firstpos1.x-firstpos2.x,2)+Math.pow(firstpos1.y-firstpos2.y,2))
				//最新一次 两个触摸点中间的距离
				var ndis= Math.sqrt( Math.pow(nowpos1.x-nowpos2.x,2)+Math.pow(fnowpos1.y-nowpos2.y,2))
				//放大或者缩小的比例
				var scale=ndis/dis
				div3.style.width=div1.offsetWidth*scale+'px'
				div3.style.height=div3.style.width
				
				//把新的触摸点位置信息保留下来，为下一次缩放做准备
				firstpos1.x=nowpos1.x
				firstpos1.y=nowpos1.y
				firstpos2.x=nowpos2.x
				firstpos2.y=nowpos2.y
			}
			document.ontouchend=function(){
				//重置ontouchmove事件
				document.ontouchmove=null
			}
		}
		</script>
	</body>
</html>

